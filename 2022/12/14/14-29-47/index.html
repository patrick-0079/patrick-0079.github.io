<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Spring security 的学习笔记 | Patrick</title><meta name="author" content="Patrick"><meta name="copyright" content="Patrick"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="学习 Spring security 的笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring security 的学习笔记">
<meta property="og:url" content="https://patrick-0079.github.io/2022/12/14/14-29-47/index.html">
<meta property="og:site_name" content="Patrick">
<meta property="og:description" content="学习 Spring security 的笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://patrick-0079.github.io/static/img/avatar.jpg">
<meta property="article:published_time" content="2022-12-14T06:29:47.000Z">
<meta property="article:modified_time" content="2022-12-15T02:10:30.000Z">
<meta property="article:author" content="Patrick">
<meta property="article:tag" content="Note">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="Spring">
<meta property="article:tag" content="Spring boot">
<meta property="article:tag" content="Microservices">
<meta property="article:tag" content="Spring security">
<meta property="article:tag" content="Securitu">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://patrick-0079.github.io/static/img/avatar.jpg"><link rel="shortcut icon" href="/static/img/logo.ico"><link rel="canonical" href="https://patrick-0079.github.io/2022/12/14/14-29-47/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring security 的学习笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-12-15 10:10:30'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/static/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/history"><i class="fa-fw fa fa-history"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/static/img/background.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Patrick</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/history"><i class="fa-fw fa fa-history"></i><span> 日志</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Spring security 的学习笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-12-14T06:29:47.000Z" title="发表于 2022-12-14 14:29:47">2022-12-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-12-15T02:10:30.000Z" title="更新于 2022-12-15 10:10:30">2022-12-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Note/">Note</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Note/Spring/">Spring</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Note/Spring/Spring-boot/">Spring boot</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Note/Spring/Spring-boot/Spring-security/">Spring security</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Spring security 的学习笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="Spring-security-学习笔记"><a href="#Spring-security-学习笔记" class="headerlink" title="Spring security 学习笔记"></a><strong>Spring security</strong> 学习笔记</h1><p>Spring security 是一个能高度定制的身份验证和访问控制框架, 是基于 Spring 应用程序标准.<br>相似的的框架有 Shrio, 相比于 Spring security, Shrio 更轻一些. Spring secuity 对于 Spring 框架的兼容性更好, 但同时也更依赖于 Spring 框架.</p>
<h2 id="关键过滤器"><a href="#关键过滤器" class="headerlink" title="关键过滤器"></a>关键过滤器</h2><h3 id="FilterSecurityInterceptor"><a href="#FilterSecurityInterceptor" class="headerlink" title="FilterSecurityInterceptor"></a>FilterSecurityInterceptor</h3><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名
  </button><span class="hide-content">org.springframework.security.web.access.intercept.FilterSecurityInterceptor</span></span>
<p>方法级权限过滤器，位于过滤链最底部</p>
<h3 id="ExceptionTranslationFilter"><a href="#ExceptionTranslationFilter" class="headerlink" title="ExceptionTranslationFilter"></a>ExceptionTranslationFilter</h3><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名
  </button><span class="hide-content">org.springframework.security.web.access.ExceptionTranslationFilter</span></span>
<p>异常过滤器，处理认证授权过程中抛出的异常</p>
<h3 id="UsernamePasswordAuthenticationFilter"><a href="#UsernamePasswordAuthenticationFilter" class="headerlink" title="UsernamePasswordAuthenticationFilter"></a>UsernamePasswordAuthenticationFilter</h3><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名
  </button><span class="hide-content">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span></span>
<p>校验/login（POST）请求提交的用户名和密码</p>
<h2 id="过滤器加载流程"><a href="#过滤器加载流程" class="headerlink" title="过滤器加载流程"></a>过滤器加载流程</h2><p>使用Spring Security配置过滤器（懒加载）</p>
<ol>
<li>在 <span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #fff;color:  #000000"> DelegatingFilterProxy
  </button><span class="hide-content">org.springframework.web.filter.DelegatingFilterProxy</span></span> 类的 doFilter() 方法中执行<span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #fff;color:  #000000"> initDelegate
  </button><span class="hide-content">Filter initDelegate(WebApplicationContext wac)</span></span> 方法来获取<span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #fff;color:  #4d4d4d"> FilterChainProxy
  </button><span class="hide-content">org.springframework.security.web.FilterChainProxy</span></span>这个过滤器链</li>
<li>在 <span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #fff;color:  #000000"> FilterChainProxy
  </button><span class="hide-content">org.springframework.security.web.FilterChainProxy</span></span> 类的 doFilter() 方法中 执行 <span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #fff;color:  #000000"> doFilterInternal
  </button><span class="hide-content">void doFilterInternal(ServletRequest request‚ ServletResponse response‚ FilterChain chain)</span></span> 方法来注册Spring Security的过滤器</li>
</ol>
<h2 id="涉及到的过滤器"><a href="#涉及到的过滤器" class="headerlink" title="涉及到的过滤器"></a><strong>涉及到的过滤器</strong></h2><div class="hide-block"><button type="button" class="hide-button" style="">查看详情
    </button><div class="hide-content"><h3 id="DisableEncodeUrlFilter"><a href="#DisableEncodeUrlFilter" class="headerlink" title="DisableEncodeUrlFilter"></a>DisableEncodeUrlFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.session.DisableEncodeUrlFilter</span></span></p>
<p>Disables encoding URLs using the HttpServletResponse to prevent including the session id in URLs which is not considered URL because the session id can be leaked in things like HTTP access logs.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>禁用使用HttpServletResponse对URL进行编码，以防止在URL中包含会话id，因为会话id可能会在HTTP访问日志等内容中泄漏，因此不被视为URL。</p>
</div></details>

<h3 id="WebAsyncManagerIntegrationFilter"><a href="#WebAsyncManagerIntegrationFilter" class="headerlink" title="WebAsyncManagerIntegrationFilter"></a>WebAsyncManagerIntegrationFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter</span></span></p>
<p>Provides integration between the SecurityContext and Spring Web’s WebAsyncManager by using the SecurityContextCallableProcessingInterceptor.beforeConcurrentHandling(org.springframework.web.context.request.NativeWebRequest, Callable) to populate the SecurityContext on the Callable.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>通过使用SecurityContextCallableProcessingInterceptor.beforencurrentHandling（org.springframework.Web.context.request.NativeWebRequest，Callable）在可调用对象上填充SecurityContext，提供SecurityContext和Spring Web的WebAsyncManager之间的集成。</p>
</div></details>

<h3 id="SecurityContextPersistenceFilter"><a href="#SecurityContextPersistenceFilter" class="headerlink" title="SecurityContextPersistenceFilter"></a><del>SecurityContextPersistenceFilter</del></h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.context.SecurityContextPersistenceFilter</span></span></p>
<p>Populates the SecurityContextHolder with information obtained from the configured SecurityContextRepository prior to the request and stores it back in the repository once the request has completed and clearing the context holder. By default it uses an HttpSessionSecurityContextRepository. See this class for information HttpSession related configuration options.<br>This filter will only execute once per request, to resolve servlet container (specifically Weblogic) incompatibilities.<br>This filter MUST be executed BEFORE any authentication processing mechanisms. Authentication processing mechanisms (e.g. BASIC, CAS processing filters etc) expect the SecurityContextHolder to contain a valid SecurityContext by the time they execute.<br>This is essentially a refactoring of the old HttpSessionContextIntegrationFilter to delegate the storage issues to a separate strategy, allowing for more customization in the way the security context is maintained between requests.<br>The forceEagerSessionCreation property can be used to ensure that a session is always available before the filter chain executes (the default is false, as this is resource intensive and not recommended).</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>使用请求之前从配置的SecurityContextRepository获得的信息填充SecurityContextHolder，并在请求完成并清除上下文持有者后将其存储回存储库中。默认情况下，它使用HttpSessionSecurityContextRepository。有关HttpSession相关配置选项的信息，请参阅此类。<br>每个请求只执行一次该过滤器，以解决servlet容器（特别是Weblogic）不兼容问题。<br>必须在任何身份验证处理机制之前执行此筛选器。身份验证处理机制（例如BASIC、CAS处理过滤器等）期望SecurityContextHolder在执行时包含有效的SecurityContext。<br>这本质上是对旧HttpSessionContextIntegrationFilter的重构，以将存储问题委托给一个单独的策略，从而允许在请求之间维护安全上下文的方式进行更多的定制。<br>forceEagleSessionCreation属性可用于确保在筛选器链执行之前会话始终可用（默认值为false，因为这是资源密集型的，不建议使用）。</p>
</div></details>

<p>已弃用,替代者: SecurityContextHolderFilter:</p>
<p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.context.SecurityContextHolderFilter</span></span></p>
<p>A javax.servlet.Filter that uses the SecurityContextRepository to obtain the SecurityContext and set it on the SecurityContextHolder. This is similar to SecurityContextPersistenceFilter except that the SecurityContextRepository.saveContext(SecurityContext, HttpServletRequest, HttpServletResponse) must be explicitly invoked to save the SecurityContext. This improves the efficiency and provides better flexibility by allowing different authentication mechanisms to choose individually if authentication should be persisted.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>javax.servlet。使用SecurityContextRepository获取SecurityContext并在SecurityContextHolder上设置它的筛选器。除了SecurityContextRepository之外，这与SecurityContextPersistenceFilter类似。必须显式调用saveContext（SecurityContext、HttpServletRequest、HttpServletsResponse）来保存SecurityContext。这通过允许不同的身份验证机制单独选择是否应持久化身份验证，提高了效率并提供了更好的灵活性。</p>
</div></details>

<h3 id="HeaderWriterFilter"><a href="#HeaderWriterFilter" class="headerlink" title="HeaderWriterFilter"></a>HeaderWriterFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.header.HeaderWriterFilter</span></span></p>
<p>Filter implementation to add headers to the current response. Can be useful to add certain headers which enable browser protection. Like X-Frame-Options, X-XSS-Protection and X-Content-Type-Options.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>筛选器实现以向当前响应添加标头。添加启用浏览器保护的某些标头可能很有用。与X-Frame-Options、X-XSS-Protect和X-Content-Type-Options类似。</p>
</div></details>

<h3 id="CsrfFilter"><a href="#CsrfFilter" class="headerlink" title="CsrfFilter"></a>CsrfFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.csrf.CsrfFilter</span></span></p>
<p>Applies CSRF protection using a synchronizer token pattern. Developers are required to ensure that CsrfFilter is invoked for any request that allows state to change. Typically this just means that they should ensure their web application follows proper REST semantics (i.e. do not change state with the HTTP methods GET, HEAD, TRACE, OPTIONS).<br>Typically the CsrfTokenRepository implementation chooses to store the CsrfToken in HttpSession with HttpSessionCsrfTokenRepository wrapped by a LazyCsrfTokenRepository. This is preferred to storing the token in a cookie which can be modified by a client application.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>使用同步器令牌模式应用CSRF保护。开发人员必须确保对任何允许状态更改的请求调用CsrfFilter。通常，这意味着他们应该确保他们的web应用程序遵循正确的REST语义（即，不要使用HTTP方法GET、HEAD、TRACE和OPTIONS更改状态）。<br>通常，CsrfTokenRepository实现选择将CsrfToken存储在HttpSession中，HttpSessionCsrfTokenRepository由LazySrfTokenStore封装。这比将令牌存储在可由客户端应用程序修改的cookie中更可取。</p>
</div></details>

<h3 id="LogoutFilter"><a href="#LogoutFilter" class="headerlink" title="LogoutFilter"></a>LogoutFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.authentication.logout.LogoutFilter</span></span></p>
<p>Logs a principal out.<br>Polls a series of LogoutHandlers. The handlers should be specified in the order they are required. Generally you will want to call logout handlers TokenBasedRememberMeServices and SecurityContextLogoutHandler (in that order).<br>After logout, a redirect will be performed to the URL determined by either the configured LogoutSuccessHandler or the logoutSuccessUrl, depending on which constructor was used.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>注销委托人。<br>轮询一系列LogoutHandler。应按照所需的顺序指定处理程序。通常，您需要调用注销处理程序TokenBasedRememberMeServices和SecurityContextLogoutHandler（按顺序）。<br>注销后，将根据使用的构造函数，重定向到由配置的LogoutSuccessHandler或LogoutSucceUrl确定的URL。</p>
</div></details>

<h3 id="UsernamePasswordAuthenticationFilter"><a href="#UsernamePasswordAuthenticationFilter" class="headerlink" title="UsernamePasswordAuthenticationFilter"></a>UsernamePasswordAuthenticationFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter</span></span></p>
<p>Processes an authentication form submission. Called AuthenticationProcessingFilter prior to Spring Security 3.0.<br>Login forms must present two parameters to this filter: a username and password. The default parameter names to use are contained in the static fields SPRING_SECURITY_FORM_USERNAME_KEY and SPRING_SECURITY_FORM_PASSWORD_KEY. The parameter names can also be changed by setting the usernameParameter and passwordParameter properties.<br>This filter by default responds to the URL /login.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>处理身份验证表单提交。在Spring Security 3.0之前调用AuthenticationProcessingFilter。<br>登录表单必须为此筛选器提供两个参数：用户名和密码。要使用的默认参数名包含在静态字段SPRING_SECURITY_FORM_USERNAME_KEY和SPRING_SETURITY_FFORM_PASSWORD_KEY中。还可以通过设置usernameParameter和passwordParameter属性来更改参数名称。<br>默认情况下，此筛选器响应URL/登录。</p>
</div></details>

<h3 id="DefaultLoginPageGeneratingFilter"><a href="#DefaultLoginPageGeneratingFilter" class="headerlink" title="DefaultLoginPageGeneratingFilter"></a>DefaultLoginPageGeneratingFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.authentication.ui.DefaultLoginPageGeneratingFilter</span></span></p>
<p>For internal use with namespace configuration in the case where a user doesn’t configure a login page. The configuration code will insert this filter in the chain instead. Will only work if a redirect is used to the login page.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>在用户未配置登录页面的情况下，用于内部命名空间配置。配置代码将在链中插入此筛选器。仅当重定向到登录页面时才有效。</p>
</div></details>

<h3 id="DefaultLogoutPageGeneratingFilter"><a href="#DefaultLogoutPageGeneratingFilter" class="headerlink" title="DefaultLogoutPageGeneratingFilter"></a>DefaultLogoutPageGeneratingFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.authentication.ui.DefaultLogoutPageGeneratingFilter</span></span></p>
<p>Generates a default log out page.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>生成默认注销页面。</p>
</div></details>

<h3 id="BasicAuthenticationFilter"><a href="#BasicAuthenticationFilter" class="headerlink" title="BasicAuthenticationFilter"></a>BasicAuthenticationFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.authentication.<a target="_blank" rel="noopener" href="http://www.basicauthenticationfilter/">www.BasicAuthenticationFilter</a></span></span></p>
<p>Processes a HTTP request’s BASIC authorization headers, putting the result into the SecurityContextHolder.<br>For a detailed background on what this filter is designed to process, refer to RFC 1945, Section 11.1 . Any realm name presented in the HTTP request is ignored.<br>In summary, this filter is responsible for processing any request that has a HTTP request header of Authorization with an authentication scheme of Basic and a Base64-encoded username:password token. For example, to authenticate user “Aladdin” with password “open sesame” the following header would be presented:<br>    Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==<br>This filter can be used to provide BASIC authentication services to both remoting protocol clients (such as Hessian and SOAP) as well as standard user agents (such as Internet Explorer and Netscape).<br>If authentication is successful, the resulting Authentication object will be placed into the SecurityContextHolder.<br>If authentication fails and ignoreFailure is false (the default), an AuthenticationEntryPoint implementation is called (unless the ignoreFailure property is set to true). Usually this should be BasicAuthenticationEntryPoint, which will prompt the user to authenticate again via BASIC authentication.<br>Basic authentication is an attractive protocol because it is simple and widely deployed. However, it still transmits a password in clear text and as such is undesirable in many situations. Digest authentication is also provided by Spring Security and should be used instead of Basic authentication wherever possible. See DigestAuthenticationFilter.<br>Note that if a RememberMeServices is set, this filter will automatically send back remember-me details to the client. Therefore, subsequent requests will not need to present a BASIC authentication header as they will be authenticated using the remember-me mechanism.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>处理HTTP请求的BASIC授权头，将结果放入SecurityContextHolder。<br>有关此筛选器设计处理的详细背景信息，请参阅RFC 1945第11.1节。HTTP请求中出现的任何领域名称都将被忽略。<br>总之，此筛选器负责处理具有HTTP请求头Authorization、身份验证方案为Basic和Base64编码的用户名：密码令牌的任何请求。例如，要使用密码“open芝麻”验证用户“Aladdin”，将显示以下标头：<br>授权：基本QWxhZGRpbjpvcGVuIHNlc2FtZQ==<br>此筛选器可用于向远程协议客户端（如Hessian和SOAP）以及标准用户代理（如Internet Explorer和Netscape）提供BASIC身份验证服务。<br>如果身份验证成功，则生成的身份验证对象将被放置到SecurityContextHolder中。<br>如果身份验证失败且ignoreFailure为false（默认值），则调用AuthenticationEntryPoint实现（除非ignoreFailion属性设置为true）。通常这应该是BasicAuthenticationEntryPoint，它将提示用户通过BASIC身份验证再次进行身份验证。<br>基本身份验证是一个有吸引力的协议，因为它简单且部署广泛。然而，它仍然以明文形式传输密码，因此在许多情况下是不可取的。摘要式身份验证也由SpringSecurity提供，应尽可能使用它来代替基本身份验证。请参阅DigestAuthenticationFilter。<br>请注意，如果设置了RememberMeServices，则此过滤器将自动向客户端发回记住我的详细信息。因此，后续请求不需要呈现BASIC认证头，因为它们将使用记住我的机制进行认证。</p>
</div></details>

<h3 id="RequestCacheAwareFilter"><a href="#RequestCacheAwareFilter" class="headerlink" title="RequestCacheAwareFilter"></a>RequestCacheAwareFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.savedrequest.RequestCacheAwareFilter</span></span></p>
<p>Responsible for reconstituting the saved request if one is cached and it matches the current request.<br>It will call getMatchingRequest on the configured RequestCache. If the method returns a value (a wrapper of the saved request), it will pass this to the filter chain’s doFilter method. If null is returned by the cache, the original request is used and the filter has no effect.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>负责重新构建保存的请求，如果其中一个请求被缓存并且与当前请求匹配。<br>它将在配置的RequestCache上调用getMatchingRequest。如果该方法返回一个值（保存的请求的包装器），它会将其传递给过滤器链的doFilter方法。如果缓存返回null，则使用原始请求，过滤器无效。</p>
</div></details>

<h3 id="SecurityContextHolderAwareRequestFilter"><a href="#SecurityContextHolderAwareRequestFilter" class="headerlink" title="SecurityContextHolderAwareRequestFilter"></a>SecurityContextHolderAwareRequestFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter</span></span></p>
<p>A Filter which populates the ServletRequest with a request wrapper which implements the servlet API security methods.<br>SecurityContextHolderAwareRequestWrapper is extended to provide the following additional methods:</p>
<ul>
<li>HttpServletRequest.authenticate(HttpServletResponse) - Allows the user to determine if they are authenticated and if not send the user to the login page. See setAuthenticationEntryPoint(AuthenticationEntryPoint).</li>
<li>HttpServletRequest.login(String, String) - Allows the user to authenticate using the AuthenticationManager. See setAuthenticationManager(AuthenticationManager).</li>
<li>HttpServletRequest.logout() - Allows the user to logout using the LogoutHandlers configured in Spring Security. See setLogoutHandlers(List).</li>
<li>AsyncContext.start(Runnable) - Automatically copy the SecurityContext from the SecurityContextHolder found on the Thread that invoked AsyncContext.start(Runnable) to the Thread that processes the Runnable.</li>
</ul>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>一个过滤器，用实现servlet API安全方法的请求包装器填充ServletRequest。<br>SecurityContextHolderAwareRequestWrapper被扩展以提供以下附加方法：</p>
<ul>
<li>HttpServletRequest.authenticate（HttpServletResponse）-允许用户确定他们是否经过身份验证，如果没有，则将用户发送到登录页面。请参见setAuthenticationEntryPoint（AuthenticationEntrePoint）。  </li>
<li>HttpServletRequest.login（String，String）-允许用户使用AuthenticationManager进行身份验证。请参阅setAuthenticationManager（AuthenticationManager）。  </li>
<li>HttpServletRequest.logout（）-允许用户使用Spring Security中配置的LogoutHandlers注销。请参见setLogoutHandlers（列表）。  </li>
<li>AsyncContext.start（Runnable）-自动从调用AsyncContext的线程上找到的SecurityContextHolder复制SecurityContext。启动（Runnable）到处理Runnable的线程。</li>
</ul>
</div></details>
 
<h3 id="AnonymousAuthenticationFilter"><a href="#AnonymousAuthenticationFilter" class="headerlink" title="AnonymousAuthenticationFilter"></a>AnonymousAuthenticationFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">rg.springframework.security.web.authentication.AnonymousAuthenticationFilter</span></span></p>
<p>Detects if there is no Authentication object in the SecurityContextHolder, and populates it with one if needed.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>检测SecurityContextHolder中是否没有身份验证对象，并在需要时用一个身份验证对象填充。</p>
</div></details>

<h3 id="SessionManagementFilter"><a href="#SessionManagementFilter" class="headerlink" title="SessionManagementFilter"></a>SessionManagementFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.session.SessionManagementFilter</span></span></p>
<p>Detects that a user has been authenticated since the start of the request and, if they have, calls the configured SessionAuthenticationStrategy to perform any session-related activity such as activating session-fixation protection mechanisms or checking for multiple concurrent logins.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>检测用户自请求开始以来是否已通过身份验证，如果已通过，则调用配置的SessionAuthenticationStrategy以执行任何与会话相关的活动，例如激活会话固定保护机制或检查多个并发登录。</p>
</div></details>

<h3 id="ExceptionTranslationFilter"><a href="#ExceptionTranslationFilter" class="headerlink" title="ExceptionTranslationFilter"></a>ExceptionTranslationFilter</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.access.ExceptionTranslationFilter</span></span></p>
<p>Handles any AccessDeniedException and AuthenticationException thrown within the filter chain.<br>This filter is necessary because it provides the bridge between Java exceptions and HTTP responses. It is solely concerned with maintaining the user interface. This filter does not do any actual security enforcement.<br>If an AuthenticationException is detected, the filter will launch the authenticationEntryPoint. This allows common handling of authentication failures originating from any subclass of org.springframework.security.access.intercept.AbstractSecurityInterceptor.<br>If an AccessDeniedException is detected, the filter will determine whether or not the user is an anonymous user. If they are an anonymous user, the authenticationEntryPoint will be launched. If they are not an anonymous user, the filter will delegate to the AccessDeniedHandler. By default the filter will use AccessDeniedHandlerImpl.<br>To use this filter, it is necessary to specify the following properties:</p>
<ul>
<li>authenticationEntryPoint indicates the handler that should commence the authentication process if an AuthenticationException is detected. Note that this may also switch the current protocol from http to https for an SSL login.</li>
<li>requestCache determines the strategy used to save a request during the authentication process in order that it may be retrieved and reused once the user has authenticated. The default implementation is HttpSessionRequestCache.</li>
</ul>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>处理筛选器链中引发的任何AccessDeniedException和AuthenticationException。<br>这个过滤器是必要的，因为它提供了Java异常和HTTP响应之间的桥梁。它只关心维护用户界面。此筛选器不执行任何实际的安全强制。<br>如果检测到AuthenticationException，则过滤器将启动authenticationEntryPoint。这允许对源自org.springframework.security.access.intercept.AbstractSecurityInterceptor的任何子类的身份验证失败进行常见处理。<br>如果检测到AccessDeniedException，则筛选器将确定用户是否为匿名用户。如果他们是匿名用户，将启动authenticationEntryPoint。如果他们不是匿名用户，则筛选器将委托给AccessDeniedHandler。默认情况下，过滤器将使用AccessDeniedHandlerImpl。<br>要使用此筛选器，必须指定以下属性：</p>
<ul>
<li>authenticationEntryPoint指示在检测到AuthenticationException时应开始身份验证过程的处理程序。注意，对于SSL登录，这也可能会将当前协议从http切换为https。</li>
<li>requestCache确定用于在身份验证过程中保存请求的策略，以便在用户进行身份验证后可以检索和重用该请求。默认实现是HttpSessionRequestCache。</li>
</ul>
</div></details>

<h3 id="FilterSecurityInterceptor"><a href="#FilterSecurityInterceptor" class="headerlink" title="FilterSecurityInterceptor"></a>FilterSecurityInterceptor</h3><p><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名<br>  </button><span class="hide-content">org.springframework.security.web.access.intercept.FilterSecurityInterceptor</span></span></p>
<p>Performs security handling of HTTP resources via a filter implementation.<br>The SecurityMetadataSource required by this security interceptor is of type FilterInvocationSecurityMetadataSource.<br>Refer to AbstractSecurityInterceptor for details on the workflow.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>通过过滤器实现执行HTTP资源的安全处理。<br>此安全拦截器所需的SecurityMetadataSource的类型为FilterInvocationSecurityMetadataSource。<br>有关工作流的详细信息，请参阅AbstractSecurityInterceptor。</p>
</div></details></div></div>

<h2 id="实现自定义的账号密码验证逻辑"><a href="#实现自定义的账号密码验证逻辑" class="headerlink" title="实现自定义的账号密码验证逻辑"></a>实现自定义的账号密码验证逻辑</h2><h3 id="创建UsernamePasswordAuthenticationFilter子类"><a href="#创建UsernamePasswordAuthenticationFilter子类" class="headerlink" title="创建UsernamePasswordAuthenticationFilter子类"></a>创建UsernamePasswordAuthenticationFilter子类</h3><p>重写下列方法</p>
<ul>
<li>Authentication attemptAuthentication(HttpServletRequest request, HttpServletResponse response)</li>
<li>void successfulAuthentication(HttpServletRequest request, HttpServletResponse response, FilterChain chain, Authentication authResult)</li>
<li>void unsuccessfulAuthentication(HttpServletRequest request, HttpServletResponse response, AuthenticationException failed)</li>
</ul>
<div class="hide-block"><button type="button" class="hide-button" style="">查看方法详情
    </button><div class="hide-content"><h4 id="attemptAuthentication方法"><a href="#attemptAuthentication方法" class="headerlink" title="attemptAuthentication方法"></a>attemptAuthentication方法</h4><p>Performs actual authentication.<br>The implementation should do one of the following:<br>-Return a populated authentication token for the authenticated user, indicating successful authentication<br>-Return null, indicating that the authentication process is still in progress. Before returning, the implementation should perform any additional work required to complete the process.<br>-Throw an AuthenticationException if the authentication process fails</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>执行实际身份验证。<br>实施应执行以下操作之一：</p>
<ul>
<li>为经过身份验证的用户返回填充的身份验证令牌，表示身份验证成功</li>
<li>返回null，表示身份验证过程仍在进行中。在返回之前，实施应执行完成流程所需的任何额外工作。</li>
<li>如果身份验证过程失败，则引发AuthenticationException</li>
</ul>
</div></details>

<h4 id="successfulAuthentication方法"><a href="#successfulAuthentication方法" class="headerlink" title="successfulAuthentication方法"></a>successfulAuthentication方法</h4><p>Default behaviour for successful authentication:</p>
<ul>
<li>Sets the successful Authentication object on the SecurityContextHolder  </li>
<li>Informs the configured RememberMeServices of the successful login  </li>
<li>Fires an InteractiveAuthenticationSuccessEvent via the configured ApplicationEventPublisher  </li>
<li>Delegates additional behaviour to the AuthenticationSuccessHandler.<br>Subclasses can override this method to continue the FilterChain after successful authentication.</li>
</ul>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>成功身份验证的默认行为:</p>
<ul>
<li>在SecurityContextHolder上设置成功的身份验证对象</li>
<li>通知已配置的RememberMeServices成功登录</li>
<li>通过配置的ApplicationEventPublisher激发InteractiveAuthenticationSuccessEvent</li>
<li>将其他行为委托给AuthenticationSuccessHandler。<br>子类可以重写此方法以在成功身份验证后继续FilterChain。</li>
</ul>
</div></details>

<h4 id="unsuccessfulAuthentication方法"><a href="#unsuccessfulAuthentication方法" class="headerlink" title="unsuccessfulAuthentication方法"></a>unsuccessfulAuthentication方法</h4><p>Default behaviour for unsuccessful authentication:<br>    Clears the SecurityContextHolder<br>    Stores the exception in the session (if it exists or allowSesssionCreation is set to true)<br>    Informs the configured RememberMeServices of the failed login<br>    Delegates additional behaviour to the AuthenticationFailureHandler.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>身份验证失败的默认行为:</p>
<ul>
<li>清除SecurityContextHolder</li>
<li>将异常存储在会话中（如果它存在或allowSesssionCreation设置为true）</li>
<li>通知配置的RememberMeServices登录失败</li>
<li>将其他行为委托给AuthenticationFailureHandler。</li>
</ul>
</div></details></div></div>

<h3 id="实现-UserDetailsService-接口"><a href="#实现-UserDetailsService-接口" class="headerlink" title="实现 UserDetailsService 接口"></a>实现 UserDetailsService 接口</h3><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名
  </button><span class="hide-content">org.springframework.security.core.userdetails.UserDetailsService</span></span>

<h4 id="oadUserByUsername方法"><a href="#oadUserByUsername方法" class="headerlink" title="oadUserByUsername方法"></a>oadUserByUsername方法</h4><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看完整方法签名
  </button><span class="hide-content">UserDetails loadUserByUsername(String username)</span></span>

<p>Locates the user based on the username. In the actual implementation, the search may possibly be case sensitive, or case insensitive depending on how the implementation instance is configured. In this case, the UserDetails object that comes back may have a username that is of a different case than what was actually requested..</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>根据用户名查找用户。在实际实现中，搜索可能区分大小写，或者不区分大小写（取决于实现实例的配置方式）。在这种情况下，返回的UserDetails对象的用户名可能与实际请求的用户名不同。</p>
</div></details>

<h3 id="实现-PasswordEncoder-接口"><a href="#实现-PasswordEncoder-接口" class="headerlink" title="实现 PasswordEncoder 接口"></a>实现 PasswordEncoder 接口</h3><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看类全名
  </button><span class="hide-content">org.springframework.security.crypto.password.PasswordEncoder</span></span>

<h4 id="encode方法"><a href="#encode方法" class="headerlink" title="encode方法"></a>encode方法</h4><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看完整方法签名
  </button><span class="hide-content">String encode(CharSequence rawPassword)</span></span>

<p>Encode the raw password. Generally, a good encoding algorithm applies a SHA-1 or greater hash combined with an 8-byte or greater randomly generated salt.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>对原始密码进行编码。通常，一个好的编码算法应用SHA-1或更大的散列，并结合8字节或更大随机生成的盐。</p>
</div></details>

<h4 id="matches方法"><a href="#matches方法" class="headerlink" title="matches方法"></a>matches方法</h4><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看完整方法签名
  </button><span class="hide-content">boolean matches(CharSequence rawPassword‚ String encodedPassword)</span></span>

<p>Verify the encoded password obtained from storage matches the submitted raw password after it too is encoded. Returns true if the passwords match, false if they do not. The stored password itself is never decoded.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>验证从存储中获得的编码密码与提交的原始密码是否匹配。如果密码匹配，则返回true，否则返回false。存储的密码本身永远不会被解码。</p>
</div></details>

<h4 id="upgradeEncoding方法"><a href="#upgradeEncoding方法" class="headerlink" title="upgradeEncoding方法"></a>upgradeEncoding方法</h4><span class="hide-inline"><button type="button" class="hide-button" style="background-color:  #808080;color:  #ffffff"> 查看完整方法签名
  </button><span class="hide-content">boolean upgradeEncoding(String encodedPassword)</span></span>

<p>Returns true if the encoded password should be encoded again for better security, else false. The default implementation always returns false.</p>
<details class="toggle"><summary class="toggle-button" style="">翻译</summary><div class="toggle-content"><p>如果为了更好的安全性，应再次对编码的密码进行编码，则返回true，否则返回false。默认实现始终返回false。</p>
</div></details>

<h2 id="设置登录的用户名和密码"><a href="#设置登录的用户名和密码" class="headerlink" title="设置登录的用户名和密码"></a><strong>设置登录的用户名和密码</strong></h2><p>设置用户名和密码一般有配置文件和配置类两种方法. 需要连接数据库时, 需要使用配置类</p>
<div class="tabs" id="set-username-password"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#set-username-password-1">配置文件</button></li><li class="tab"><button type="button" data-href="#set-username-password-2">配置类</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="set-username-password-1"><figure class="highlight properties"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring.security.user.name</span>=<span class="string">username</span></span><br><span class="line"><span class="attr">spring.security.user.password</span>=<span class="string">password</span></span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="set-username-password-2"><p>继承自<del>org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter</del>类的配置类，现在已弃用。现在推荐配置UserDetailsService的Bean</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.NoOpPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.provisioning.InMemoryUserDetailsManager;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span> {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    UserDetailsService <span class="title function_">userDetailsService</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// 配置用户名和密码</span></span><br><span class="line">        <span class="type">InMemoryUserDetailsManager</span> <span class="variable">users</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserDetailsManager</span>();</span><br><span class="line">        users.createUser(User.withUsername(<span class="string">"user"</span>).password(<span class="string">"password"</span>).roles(<span class="string">"admin"</span>).build());</span><br><span class="line">        <span class="keyword">return</span> users;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置加密器</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PasswordEncoder <span class="title function_">passwordEncoder</span><span class="params">()</span> {</span><br><span class="line">        <span class="keyword">return</span> NoOpPasswordEncoder.getInstance(); <span class="comment">// 不加密. 加密器详情见 PasswordEncoder 子类, 常用 BC 加密器</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>

<h2 id="访问权限配置"><a href="#访问权限配置" class="headerlink" title="访问权限配置"></a>访问权限配置</h2><p>配置SecurityFilterChain的Bean, 若配置发生冲突, 则以先匹配到的规则为准:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.NoOpPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.rememberme.JdbcTokenRepositoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.rememberme.PersistentTokenRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span>() {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="keyword">return</span> http</span><br><span class="line">                .formLogin() <span class="comment">// 登录设置</span></span><br><span class="line">                .loginPage(<span class="string">"/common/login"</span>) <span class="comment">// 配置登录页面路径</span></span><br><span class="line">                .loginProcessingUrl(<span class="string">"/login"</span>) <span class="comment">// 登录数据处理路径</span></span><br><span class="line">                .defaultSuccessUrl(<span class="string">"/common/index"</span>) <span class="comment">// 登录成功后跳转路径</span></span><br><span class="line"></span><br><span class="line">                .and().logout().logoutUrl(<span class="string">"/destroy"</span>) <span class="comment">// 设置注销接口路径</span></span><br><span class="line">                .logoutSuccessUrl(<span class="string">"/common/index"</span>)<span class="comment">// 设置注销成功后跳转页面</span></span><br><span class="line">                .permitAll()</span><br><span class="line"></span><br><span class="line">                .and().authorizeRequests() <span class="comment">//配置页面访问权限</span></span><br><span class="line">                .antMatchers(<span class="string">"/common/index"</span>, <span class="string">"/common/login"</span>).permitAll() <span class="comment">// 设置可直接访问的路径</span></span><br><span class="line"></span><br><span class="line">                .antMatchers(<span class="string">"/authority/boom"</span>).hasAuthority(<span class="string">"boom"</span>) <span class="comment">//根据权限配置可访问路径</span></span><br><span class="line">                .antMatchers(<span class="string">"/authority/read"</span>).hasAuthority(<span class="string">"read"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/authority/write"</span>).hasAuthority(<span class="string">"write"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/authority/read/write"</span>).hasAnyAuthority(<span class="string">"read"</span>, <span class="string">"write"</span>)</span><br><span class="line"></span><br><span class="line">                .antMatchers(<span class="string">"/role/boss"</span>).hasRole(<span class="string">"boss"</span>) <span class="comment">//根据角色配置可访问路径</span></span><br><span class="line">                .antMatchers(<span class="string">"/role/worker"</span>).hasAuthority(<span class="string">"ROLE_worker"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/role/root"</span>).hasRole(<span class="string">"root"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/role/boss/worker"</span>).hasAnyRole(<span class="string">"boss"</span>, <span class="string">"worker"</span>)</span><br><span class="line"></span><br><span class="line">                .antMatchers(<span class="string">"/ip/localhost"</span>).hasIpAddress(<span class="string">"192.168.0.0/16"</span>) <span class="comment">//根据IP配置可访问路径</span></span><br><span class="line">                .antMatchers(<span class="string">"/ip/localhost"</span>).hasIpAddress(<span class="string">"127.0.0.0/8"</span>)</span><br><span class="line"></span><br><span class="line">                .anyRequest().authenticated() <span class="comment">// 其他所有页面皆为认证用户访问</span></span><br><span class="line"></span><br><span class="line">                .and().exceptionHandling().accessDeniedPage(<span class="string">"/error/403.html"</span>)<span class="comment">// 配置 403 路径</span></span><br><span class="line"></span><br><span class="line">                .and().csrf().disable() <span class="comment">// 关闭CSRF防护</span></span><br><span class="line">                .build();</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h2 id="登录页面"><a href="#登录页面" class="headerlink" title="登录页面"></a>登录页面</h2><p>必须提交POST表单, 默认情况下, 用户名的name为username, 密码的name为password</p>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p>先开在启动类开启 @EnableGlobalMethodSecurity</p>
<ul>
<li>@Secured<br>  先开在启动类开启 @EnableGlobalMethodSecurity(securedEnabled = true),对角色进行访问控制, 使用时对角色前加ROLE_前缀, 不支持对资源进行访问控制<br>  例如<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Secured({"ROLE_worker", "ROLE_boss"})</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>@PreAuthorize<br>  先开在启动类开启 @EnableGlobalMethodSecurity(prePostEnabled=true),提供了基于表达式的访问控制<br>  例如:<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PreAuthorize("hasAnyRole('worker','boss')")</span></span><br><span class="line"><span class="meta">@PreAuthorize("hasRole('worker') AND hasRole('boss')")</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>@PostAuthorize:<br>  先开在启动类开启 @EnableGlobalMethodSecurity(prePostEnabled=true),在方法执行后再进行权限验证, 适合验证带有返回值的权限, Spring EL 提供 返回对象能够在表达式语言中获取返回的对象returnObject, 提供了基于表达式的访问控制<br>  例如<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostAuthorize(" returnObject != null &amp;&amp;  returnObject.username == authentication.name")</span></span><br></pre></td></tr></tbody></table></figure></li>
<li>@PostFilter<br>  对返回数据过滤<br>  例如</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PostFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">controllerTest</span>() {</span><br><span class="line">    <span class="meta">@GetMapping("/post/filter")</span></span><br><span class="line">    <span class="meta">@PostFilter("filterObject.username == '1'")</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">PostFilter</span><span class="params">()</span> {</span><br><span class="line">        List&lt;User&gt; userList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">User</span>().setUsername(<span class="string">"1"</span>));</span><br><span class="line">        userList.add(<span class="keyword">new</span> <span class="title class_">User</span>().setUsername(<span class="string">"2"</span>));</span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回数据</span></span><br><span class="line">        <span class="comment">// [{</span></span><br><span class="line">        <span class="comment">// "deleteFlag":null,</span></span><br><span class="line">        <span class="comment">// "lockFlag":null,</span></span><br><span class="line">        <span class="comment">// "userId":null,</span></span><br><span class="line">        <span class="comment">// "username":"1",</span></span><br><span class="line">        <span class="comment">// "password":null,</span></span><br><span class="line">        <span class="comment">// "authorities":null,</span></span><br><span class="line">        <span class="comment">// "enabled":false,</span></span><br><span class="line">        <span class="comment">// "credentialsNonExpired":false,</span></span><br><span class="line">        <span class="comment">// "accountNonExpired":false,</span></span><br><span class="line">        <span class="comment">// "accountNonLocked":false</span></span><br><span class="line">        <span class="comment">// }]</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<ul>
<li>@PreFilter<br>  对传入参数过滤<br>  例如<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.security.access.prepost.PostFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">controllerTest</span>() {</span><br><span class="line">    <span class="meta">@PostMapping("/pre/filter")</span></span><br><span class="line">    <span class="meta">@PostFilter("filterObject.username == '1'")</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">PreFilter</span><span class="params">(<span class="meta">@RequestBody</span> List&lt;User&gt; userList)</span>{</span><br><span class="line">        <span class="comment">// 传入数据</span></span><br><span class="line">        <span class="comment">//[{</span></span><br><span class="line">        <span class="comment">//    "username": "1"</span></span><br><span class="line">        <span class="comment">//},{</span></span><br><span class="line">        <span class="comment">//    "username": "2"</span></span><br><span class="line">        <span class="comment">//},{</span></span><br><span class="line">        <span class="comment">//    "username": "3"</span></span><br><span class="line">        <span class="comment">//}]</span></span><br><span class="line">        <span class="keyword">return</span> userList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回数据</span></span><br><span class="line">        <span class="comment">//[</span></span><br><span class="line">        <span class="comment">//    {</span></span><br><span class="line">        <span class="comment">//        "deleteFlag": null,</span></span><br><span class="line">        <span class="comment">//        "lockFlag": null,</span></span><br><span class="line">        <span class="comment">//        "userId": null,</span></span><br><span class="line">        <span class="comment">//        "username": "1",</span></span><br><span class="line">        <span class="comment">//        "password": null,</span></span><br><span class="line">        <span class="comment">//        "authorities": null,</span></span><br><span class="line">        <span class="comment">//        "enabled": false,</span></span><br><span class="line">        <span class="comment">//        "credentialsNonExpired": false,</span></span><br><span class="line">        <span class="comment">//        "accountNonExpired": false,</span></span><br><span class="line">        <span class="comment">//        "accountNonLocked": false</span></span><br><span class="line">        <span class="comment">//    }</span></span><br><span class="line">        <span class="comment">//]</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure></li>
</ul>
<h2 id="自动登录"><a href="#自动登录" class="headerlink" title="自动登录"></a>自动登录</h2><p>配置自动登录Service</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.builders.HttpSecurity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.config.annotation.web.configuration.WebSecurityCustomizer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.core.userdetails.UserDetailsService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.NoOpPasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.crypto.password.PasswordEncoder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.SecurityFilterChain;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.rememberme.JdbcTokenRepositoryImpl;</span><br><span class="line"><span class="keyword">import</span> org.springframework.security.web.authentication.rememberme.PersistentTokenRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Config</span>() {</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    PersistentTokenRepository <span class="title function_">persistentTokenRepository</span><span class="params">(DataSource dataSource)</span> {</span><br><span class="line">        <span class="type">JdbcTokenRepositoryImpl</span> <span class="variable">jdbcTokenRepository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcTokenRepositoryImpl</span>();</span><br><span class="line">        jdbcTokenRepository.setDataSource(dataSource);</span><br><span class="line">        <span class="comment">// jdbcTokenRepository.setCreateTableOnStartup(true); // 自动创建所需要的表</span></span><br><span class="line">        <span class="keyword">return</span> jdbcTokenRepository;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    SecurityFilterChain <span class="title function_">filterChain</span><span class="params">(HttpSecurity http,</span></span><br><span class="line"><span class="params">                                    PersistentTokenRepository persistentTokenRepository,</span></span><br><span class="line"><span class="params">                                    UserDetailsService userDetailsService)</span> <span class="keyword">throws</span> Exception {</span><br><span class="line">        <span class="keyword">return</span> http.rememberMe().tokenRepository(persistentTokenRepository) <span class="comment">// 配置自动登录</span></span><br><span class="line">                .tokenValiditySeconds(<span class="number">60</span>)<span class="comment">// 自动登录有效时常</span></span><br><span class="line">                .userDetailsService(userDetailsService);</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<hr>
<div class="flink"><div class="flink-name">Spring security 相关文档</div> <div class="flink-list">
          <div class="flink-list-item">
            <a href="https://spring.io/projects/spring-security" title="Spring security Documentation" target="_blank">
              <div class="flink-item-icon">
                <img class="no-lightbox" src="https://spring.io/images/spring-logo-2022-dark-2f10e8055653ec50e693eb444291d742.svg" onerror="this.onerror=null;this.src=&quot;/img/friend_404.gif&quot;" alt="Spring security Documentation">
              </div>
              <div class="flink-item-name">Spring security Documentation</div> 
              <div class="flink-item-desc" title="Spring security 官方文档">Spring security 官方文档</div>
            </a>
          </div></div></div></article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Note/">Note</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a><a class="post-meta__tags" href="/tags/Spring-boot/">Spring boot</a><a class="post-meta__tags" href="/tags/Microservices/">Microservices</a><a class="post-meta__tags" href="/tags/Spring-security/">Spring security</a><a class="post-meta__tags" href="/tags/Securitu/">Securitu</a></div><div class="post_share"><div class="social-share" data-image="/static/img/avatar.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/12/14/19-30-57/" title="Eureka 的学习笔记"><img class="cover" src="/static/img/background.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Eureka 的学习笔记</div></div></a></div><div><a href="/2022/12/14/11-52-35/" title="Groovy 的学习笔记"><img class="cover" src="/static/img/background.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Groovy 的学习笔记</div></div></a></div><div><a href="/2022/12/14/09-16-35/" title="Lua 的学习笔记"><img class="cover" src="/static/img/background.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Lua 的学习笔记</div></div></a></div><div><a href="/2022/12/13/10-01-00/" title="Markdown 的学习笔记"><img class="cover" src="/static/img/background.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-13</div><div class="title">Markdown 的学习笔记</div></div></a></div><div><a href="/2022/12/14/21-44-00/" title="Nginx 的学习笔记"><img class="cover" src="/static/img/background.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="title">Nginx 的学习笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/static/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Patrick</div><div class="author-info__description">大学牲, 明年失业, 目前尚在摆烂中</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">8</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/patrick-0079"><i class="fab fa-github"></i><span>patrick-0079</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="/patrick0079@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring-security-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0"><span class="toc-text">Spring security 学习笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">关键过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#FilterSecurityInterceptor"><span class="toc-text">FilterSecurityInterceptor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExceptionTranslationFilter"><span class="toc-text">ExceptionTranslationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UsernamePasswordAuthenticationFilter"><span class="toc-text">UsernamePasswordAuthenticationFilter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="toc-text">过滤器加载流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B6%89%E5%8F%8A%E5%88%B0%E7%9A%84%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-text">涉及到的过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DisableEncodeUrlFilter"><span class="toc-text">DisableEncodeUrlFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WebAsyncManagerIntegrationFilter"><span class="toc-text">WebAsyncManagerIntegrationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SecurityContextPersistenceFilter"><span class="toc-text">SecurityContextPersistenceFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HeaderWriterFilter"><span class="toc-text">HeaderWriterFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CsrfFilter"><span class="toc-text">CsrfFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LogoutFilter"><span class="toc-text">LogoutFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UsernamePasswordAuthenticationFilter"><span class="toc-text">UsernamePasswordAuthenticationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DefaultLoginPageGeneratingFilter"><span class="toc-text">DefaultLoginPageGeneratingFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DefaultLogoutPageGeneratingFilter"><span class="toc-text">DefaultLogoutPageGeneratingFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BasicAuthenticationFilter"><span class="toc-text">BasicAuthenticationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RequestCacheAwareFilter"><span class="toc-text">RequestCacheAwareFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SecurityContextHolderAwareRequestFilter"><span class="toc-text">SecurityContextHolderAwareRequestFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AnonymousAuthenticationFilter"><span class="toc-text">AnonymousAuthenticationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SessionManagementFilter"><span class="toc-text">SessionManagementFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ExceptionTranslationFilter"><span class="toc-text">ExceptionTranslationFilter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#FilterSecurityInterceptor"><span class="toc-text">FilterSecurityInterceptor</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%AF%86%E7%A0%81%E9%AA%8C%E8%AF%81%E9%80%BB%E8%BE%91"><span class="toc-text">实现自定义的账号密码验证逻辑</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAUsernamePasswordAuthenticationFilter%E5%AD%90%E7%B1%BB"><span class="toc-text">创建UsernamePasswordAuthenticationFilter子类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#attemptAuthentication%E6%96%B9%E6%B3%95"><span class="toc-text">attemptAuthentication方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#successfulAuthentication%E6%96%B9%E6%B3%95"><span class="toc-text">successfulAuthentication方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#unsuccessfulAuthentication%E6%96%B9%E6%B3%95"><span class="toc-text">unsuccessfulAuthentication方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-UserDetailsService-%E6%8E%A5%E5%8F%A3"><span class="toc-text">实现 UserDetailsService 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#oadUserByUsername%E6%96%B9%E6%B3%95"><span class="toc-text">oadUserByUsername方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0-PasswordEncoder-%E6%8E%A5%E5%8F%A3"><span class="toc-text">实现 PasswordEncoder 接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#encode%E6%96%B9%E6%B3%95"><span class="toc-text">encode方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#matches%E6%96%B9%E6%B3%95"><span class="toc-text">matches方法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#upgradeEncoding%E6%96%B9%E6%B3%95"><span class="toc-text">upgradeEncoding方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E7%99%BB%E5%BD%95%E7%9A%84%E7%94%A8%E6%88%B7%E5%90%8D%E5%92%8C%E5%AF%86%E7%A0%81"><span class="toc-text">设置登录的用户名和密码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E9%85%8D%E7%BD%AE"><span class="toc-text">访问权限配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-text">登录页面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E8%A7%A3"><span class="toc-text">注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95"><span class="toc-text">自动登录</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/16/08-36-38/" title="Union-find 算法笔记">Union-find 算法笔记</a><time datetime="2022-12-16T00:36:38.000Z" title="发表于 2022-12-16 08:36:38">2022-12-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/14/21-44-00/" title="Nginx 的学习笔记">Nginx 的学习笔记</a><time datetime="2022-12-14T13:44:00.000Z" title="发表于 2022-12-14 21:44:00">2022-12-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/14/19-30-57/" title="Eureka 的学习笔记">Eureka 的学习笔记</a><time datetime="2022-12-14T11:30:57.000Z" title="发表于 2022-12-14 19:30:57">2022-12-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/14/14-29-47/" title="Spring security 的学习笔记">Spring security 的学习笔记</a><time datetime="2022-12-14T06:29:47.000Z" title="发表于 2022-12-14 14:29:47">2022-12-14</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2022/12/14/11-52-35/" title="Groovy 的学习笔记">Groovy 的学习笔记</a><time datetime="2022-12-14T03:52:35.000Z" title="发表于 2022-12-14 11:52:35">2022-12-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/static/img/foot.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Patrick</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, welcome to Patrick's blog!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="Hello,This,is,Patrick,Nice,to,meet,you" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>